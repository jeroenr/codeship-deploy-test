- name: Run tests
  tag: ^(feature/.*)$
  service: build
  dockercfg_service: gcr_dockercfg
  command: sbt test

- name: Build image
  tag: ^(develop|master|release.*)
  service: build
  dockercfg_service: gcr_dockercfg
  command: sbt docker:publishLocal

- name: List target dir
  tag: ^(develop|master|release.*)
  service: testvolume
  command: ls /tmp/target

- name: View Dockerfile
  tag: ^(develop|master|release.*)
  service: testvolume
  command: cat /tmp/target/docker/Dockerfile

#- name: Push image
#  tag: ^(develop|master|release.*)
#  service: testapp
#  dockercfg_service: gcr_dockercfg
#  command: sbt docker:publish

- name: Push
  tag: ^(develop|master|release.*)
  type: push
  service: deploy
  image_name: eu.gcr.io/weeronline-apps/hello-world
  image_tag: "{{.CommitID}}"
  registry: eu.gcr.io
  dockercfg_service: gcr_dockercfg